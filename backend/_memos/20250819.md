이번에 학습한 Spring Cloud를 통한 MSA의 전체 틀에 대해서 내가 메모한 내용이야

의존성 설명 부분은 반드시 넣어서 첨삭자료를 만들어줘

ChatGPT의 말:

# Spring Cloud 기반 MSA 전체 구조 정리

## 1. 기동 단계

1. `infra`의 `docker-compose` 가동으로 시작
    - 현재는 DB, RabbitMQ, Zipkin을 먼저 기동
2. Config Server 기동
3. Eureka Server 기동
4. API Gateway, User/Product/Order/Payment/Notification Service 기동
5. (차후 계획) 도커 컴포즈에 모든 서비스를 통합할 경우 실행 순서는 조정 필요
6. Frontend에서 `npm run dev`

---

## 2. 서비스 간 연결 및 작업 흐름

- Frontend 서비스에서 API Gateway를 통해 백엔드 서비스 모음에 접근
- User Service를 통해 로그인
- Product Service를 통해 상품 목록 확인 → 원하는 상품 선택 후 주문 요청

### Order Service
- 프론트의 주문 요청을 받아 동작
- **UserServiceClient (OpenFeign)** → User Service로부터 주문자 정보 획득
- 주문 정보를 자체 DB에 저장
- **OrderEventPublisher (RabbitMQ)** → 주문 생성 이벤트 발행  
  → 큐를 통해 Notification Service, Product Service에 전송

(이후 큐를 통한 전송은 생략)

### Product Service
- Order Service가 발행한 주문 생성 이벤트 수신
- **ProductSagaHandler** → 재고 차감 시도
    - 실패 시 → **ProductSagaPublisher**를 통해 주문 취소 이벤트를 Order Service에 발행
    - 성공 시 → **ProductSagaPublisher**를 통해 결제 요청 이벤트를 Payment Service에 발행

### Payment Service
- Product Service가 발행한 결제 요청 이벤트 수신
- **PaymentSagaHandler** → 결제 시도
    - 성공 시 → **PaymentSagaPublisher**를 통해 결제 성공 이벤트를 Order Service에 발행
    - 실패 시 → **PaymentSagaPublisher**를 통해 결제 실패 이벤트를 Order Service와 Product Service에 발행

### Order Service (최종 처리)
- 결제 성공 이벤트 수신 → 주문 완료 처리
- 결제 실패 이벤트 수신 → 주문 취소 처리
- Order Service와 별도로 Product Service도 결제 실패 이벤트를 수신받아 재고 복구 처리

---

## 3. 각종 의존성 (Dependency)

### 서비스 관리
- **Config Server**: 각 서비스 서버별 설정 중앙 관리
- **Config Client**: Config Server의 설정을 가져오기 위한 클라이언트

### 서비스 등록/발견
- **Eureka Server**: 서비스 디스커버리 서버
- **Eureka Discovery Client**: Eureka를 통한 서비스 등록/발견 클라이언트

### 외부 연결
- **API Gateway**: 외부 서비스(프론트엔드)와 백엔드 서비스 묶음을 연결

### 분산 추적/모니터링
- **Micrometer**: `io.micrometer:micrometer-tracing-bridge-otel`
- **Zipkin Exporter**: `io.opentelemetry:opentelemetry-exporter-zipkin`

### 서비스 간 통신
- **OpenFeign**: 외부 서비스와의 선언형 HTTP 통신
- **RabbitMQ**: 이벤트 기반 비동기 메시징

### 서비스 회복성
- **Resilience4j**: 회복성 패턴 적용 (서킷 브레이커, 재시도, 폴백 등)

### 서비스 상태 관리
- **Spring Boot Actuator**: 서비스 상태, 헬스체크, 모니터링 제공
